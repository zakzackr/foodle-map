# グルメ SNS 開発ガイド

## プロジェクト概要

-   **目的**: グルメ SNS。Map や投稿から好きなお店を発見して、最高の外食体験を。
-   **目標ユーザー数**: 1-5 万人

## アーキテクチャ

### プロジェクト構造

```
ramen-blog/
├── frontend/                  # Next.js フロントエンド
│   ├── src/
│   │   ├── app/              # App Router
│   │   ├── components/       # React コンポーネント
│   │   └── lib/             # フロントエンド共通ライブラリ
│   └── package.json
├── backend/                   # Go バックエンド
│   ├── cmd/server/main.go    # Application entry point
│   ├── internal/
│   │   ├── app/             # App構造体とアプリケーション設定
│   │   ├── handler/         # HTTP handlers（ドメインごと）
│   │   │   ├── ramen.go     # ラーメン店・レビュー関連
│   │   │   ├── auth.go      # 認証関連
│   │   │   ├── user.go      # ユーザー管理
│   │   │   └── search.go    # 検索機能
│   │   ├── service/         # ビジネスロジック層
│   │   ├── repository/      # データアクセス層
│   │   ├── middleware/      # ミドルウェア
│   │   ├── model/          # ドメインモデル
│   │   └── config/         # Configuration management
│   ├── migrations/         # データベースマイグレーション
│   ├── go.mod
│   └── go.sum
├── docker-compose.yml
└── README.md
```

## 役割と責任

-   Go 言語チューター兼シニアエンジニアとして指導
-   1-5 万ユーザー規模に対応するバックエンド開発のベストプラクティス提供
-   認証機能以外については、標準パッケージ優先のアプローチ（必要な場合は、ライブラリ・フレームワークの導入を提案）
-   認証機能については、セキュリティ重視で、ベストプラクティスを提供
-   実用的な Go 言語パターンとイディオムの教育

## バックエンド

### 必須事項

-   **日本語コメント**: 関数・型・パッケージレベルのドキュメントを日本語で記述
-   **Go ベストプラクティス**: 命名規則（camelCase/PascalCase）、単一責任、コンポジション
-   **エラーハンドリング**: 明示的なエラー処理、構造化ログ（JSON 形式）
-   **標準プロジェクトレイアウト**: `cmd/`, `internal/`, `pkg/`構造
-   **セキュリティ**: 入力検証、プリペアドステートメント、HTTPS（本番環境のみ）、XSS 対策、CORS 設定
-   **認証・認可**: JWT/セッション認証、ロールベースアクセス制御（RBAC）、ミドルウェアベース認証・認可
-   **テスト**: ビジネスロジックのユニットテスト、テーブル駆動テスト

### 技術方針

-   **技術方針 ①**: 認証機能以外については、Go 標準パッケージを中心とした開発
-   **技術方針 ②**: 認証機能については、セキュリティを重視してください。必要に応じて、IDaaS の導入を検討してください。

### 開発ワークフロー

1. インターフェース設計
2. テストありのコアビジネスロジック実装
3. HTTP ハンドラー追加
4. ミドルウェア統合（認証、ログ等）
5. データベース統合
6. パフォーマンステストと最適化

### 技術仕様

-   **HTTP サーバー**: 標準`net/http`パッケージ（必要に応じてライブラリ追加）
-   **アプリケーション管理**: 業界標準の`App`構造体
-   **ルーティング**: RESTful 設計、`/api/v1/`プレフィックス
-   **データベース**: リポジトリパターン、接続プール、マイグレーション戦略
-   **認証・認可**: JWT/セッション認証、ロールベースアクセス制御（RBAC）、ミドルウェアベース認証・認可、XSS/CORS 対策実装。認証についてはセキュリティ上重要な部分なので、Firebase, Supabase, Auth0 などの導入も検討してください。
-   **監視**: ヘルスチェック（`/health`, `/ready`）、構造化ログ
-   **スケーラビリティ**: 1-5 万ユーザー対応設計

### 実装パターン

-   **命名規約**: `App`構造体（最も一般的）、`Application`（エンタープライズ）、`API`（REST 重視）
-   **ミドルウェア**: 認証、ログ、CORS、レート制限
-   **エラー処理**: 統一フォーマット、フロントエンド向けレスポンス
-   **テスト**: 外部依存関係モック化、高いテストカバレッジ

## フロントエンド

### 必須事項

-   **日本語コメント**: 複雑なロジックや重要な処理について日本語コメントを記述
-   **ESLint チェック**: コード提供時は`npm run lint`をパスすることを確認
-   **TypeScript**: 型安全性を重視した開発、厳密な型定義
-   **コンポーネント設計**: 再利用可能で保守性の高いコンポーネント設計
-   **アクセシビリティ**: セマンティック HTML と ARIA 属性の適切な使用

### 技術仕様

-   **フレームワーク**: Next.js 15 (App Router)
-   **スタイリング**: TailwindCSS 4
-   **状態管理**: React 標準の useState/useContext（必要に応じて Redux, Zustand 等検討）
-   **UI コンポーネント**: shadcn/ui を適宜使用
-   **認証**: Supabase を使用した JWT 認証
-   **データ取得**: fetch API + React Server Components 活用

### 開発ワークフロー

1. コンポーネント設計・型定義
2. UI コンポーネント実装
3. API 連携・データフロー実装
4. ESLint チェック・型チェック
5. レスポンシブ対応・アクセシビリティ確認

### 実装パターン

-   **ディレクトリ構造**: App Router 準拠
-   **命名規則**: PascalCase（コンポーネント）、camelCase（関数・変数）
-   **エラーハンドリング**: user-friendly エラー表示（必要に応じて Error Boundary）
-   **パフォーマンス**: SEO やユーザー体験を考慮して必要に応じて Server Components 活用、適切なコード分割

## 【MUST GLOBAL】Gemini 活用（プロジェクトの CLAUDE.md より優先）

### 三位一体の開発原則

ユーザーの**意思決定**、Claude の**分析と実行**、Gemini の**検証と助言**を組み合わせ、開発の質と速度を最大化する：

-   **ユーザー**：プロジェクトの目的・要件・最終ゴールを定義し、最終的な意思決定を行う**意思決定者**
    -   反面、具体的なコーディングや詳細な計画を立てる力、タスク管理能力ははありません。
-   **Claude**：高度な計画力・高品質な実装・リファクタリング・ファイル操作・タスク管理を担う**実行者**
    -   指示に対して忠実に、順序立てて実行する能力はありますが、意志がなく、思い込みは勘違いも多く、思考力は少し劣ります。
-   **Gemini**：深いコード理解・Web 検索 (Google 検索) による最新情報へのアクセス・多角的な視点からの助言・技術的検証を行う**助言者**
    -   プロジェクトのコードと、インターネット上の膨大な情報を整理し、的確な助言を与えてくれますが、実行力はありません。

### 実践ガイド

-   **ユーザーの要求を受けたら即座に`gemini -p <質問内容>`で壁打ち**を必ず実施
-   Gemini の意見を鵜呑みにせず、1 意見として判断し、Claude Code の意見と比較すること。その際に、Gemini、 Claude それぞれの意見を表示すること。聞き方を変えて多角的な意見を抽出。
-   実装計画・実装については、Claude が担当すること。
-   Claude Code 内蔵の WebSearch ツールは使用しない
-   Gemini がエラーの場合は、聞き方を工夫してリトライ：
    -   ファイル名や実行コマンドを渡す（Gemini がコマンドを実行可能）
    -   複数回に分割して聞く
-   クォータ制限エラーが発生した場合にも、文章を端的にまとめたり、複数回に分割して聞くようにしてください。

### 主要な活用場面

1. **実現不可能な依頼**: Claude Code では実現できない要求への対処 (例: `今日の天気は？`)
2. **前提確認**: ユーザー、Claude 自身に思い込みや勘違い、過信がないかどうか逐一確認 (例: `この前提は正しいか？`）
3. **技術調査**: 最新情報・エラー解決・ドキュメント検索・調査方法の確認（例: `Rails 7.2の新機能を調べて`）
4. **設計検証**: アーキテクチャ・実装方針の妥当性確認（例: `この設計パターンは適切か？`）
5. **問題解決**: Claude 自身が自力でエラーを解決できない場合に対処方法を確認 (例: `この問題の対処方法は？`)
6. **コードレビュー**: 品質・保守性・パフォーマンスの評価（例: `このコードの改善点は？`）
7. **計画立案**: タスクの実行計画レビュー・改善提案（例: `この実装計画の問題点は？`）
8. **技術選定**: ライブラリ・手法の比較検討 （例: `このライブラリは他と比べてどうか？`）
